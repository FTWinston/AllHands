import { Vulnerability } from 'common-types';
import { classNames } from 'common-ui/utils/classNames';
import { getVulnerabilityDescription } from 'common-ui/utils/getVulnerabilityDescription';
import { InfoPopup } from 'common-ui/components/InfoPopup';
import { ToggleButton } from 'common-ui/components/ToggleButton';
import { CardDropTarget } from 'src/components/CardDropTarget';
import styles from './VulnerabiltyIndicator.module.css';

type Props = {
    vulnerability: Vulnerability;
    targetId: string;
    onSelected: (isSelected: boolean) => void;
    isSelected: boolean;
    anySelected: boolean;
    index: number;
    hidden?: boolean;
};

export const VulnerabilityIndicator = (props: Props) => {
    const { name, description, image } = getVulnerabilityDescription(props.vulnerability);

    return (
        <CardDropTarget
            targetType="enemy"
            id={props.targetId}
            disabled={!props.isSelected}
            className={classNames(styles.dropTarget, props.hidden ? styles.hiddenDropTarget : undefined)}
            // @ts-expect-error CSS custom property
            style={{ '--index': props.index }}
        >
            <InfoPopup
                className={classNames(styles.vulnerability, props.anySelected && !props.isSelected ? styles.otherIsSelected : undefined)}
                name={name}
                description={(
                    <>
                        {description}

                        <div className={styles.buttons}>
                            <ToggleButton pressed={props.isSelected} onPressedChanged={props.onSelected}>
                                Target this vulnerability
                            </ToggleButton>
                        </div>
                    </>
                )}
                palette={props.isSelected ? 'danger' : 'primary'}
            >
                {image}
            </InfoPopup>
        </CardDropTarget>
    );
};
