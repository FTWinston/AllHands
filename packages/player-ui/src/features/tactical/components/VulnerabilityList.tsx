import { Vulnerability } from 'common-types';
import { useArrayChanges } from 'src/hooks/useArrayChanges';
import { VulnerabilityIndicator } from './VulnerabilityIndicator';

type Props = {
    className?: string;
    vulnerabilities: Vulnerability[];
    targetId: string;
    selectedVulnerability: Vulnerability | null;
    selectVulnerability?: (vulnerability: Vulnerability | null) => void;
};

const getVulnerabilityId = (vulnerability: Vulnerability) => vulnerability;

export const VulnerabilityList = (props: Props) => {
    const { knownItems, currentItemIds, removingItemIds } = useArrayChanges(props.vulnerabilities, getVulnerabilityId);

    return (
        <div className={props.className}>
            {knownItems.map(vulnerability => (
                <VulnerabilityIndicator
                    key={vulnerability}
                    targetId={props.targetId}
                    vulnerability={vulnerability}
                    isSelected={props.selectedVulnerability === vulnerability}
                    anySelected={!!props.selectedVulnerability}
                    onSelected={isSelected => props.selectVulnerability?.(isSelected ? vulnerability : null)}
                    hidden={removingItemIds.has(vulnerability) || !currentItemIds.has(vulnerability)}
                />
            ))}
        </div>
    );
};
