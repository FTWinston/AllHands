import { Vulnerability } from 'common-data/types/Vulnerability';
import { classNames } from 'common-ui/utils/classNames';
import { useArrayChanges } from 'src/hooks/useArrayChanges';
import { VulnerabilityIndicator } from './VulnerabilityIndicator';
import styles from './VulnerabiltyList.module.css';

type Props = {
    className?: string;
    vulnerabilities: Vulnerability[];
    targetId: string;
    selectedVulnerability: Vulnerability | null;
    selectVulnerability?: (vulnerability: Vulnerability | null) => void;
};

const getVulnerabilityId = (vulnerability: Vulnerability) => vulnerability;

export const VulnerabilityList = (props: Props) => {
    const { knownItems, currentItemIds, removingItemIds } = useArrayChanges(props.vulnerabilities, getVulnerabilityId);

    return (
        <div
            className={classNames(styles.list, props.className)}
            // @ts-expect-error CSS custom property
            style={{ '--count': knownItems.length }}
        >
            {knownItems.map((vulnerability, index) => (
                <VulnerabilityIndicator
                    key={vulnerability}
                    index={index}
                    targetId={props.targetId}
                    vulnerability={vulnerability}
                    isSelected={props.selectedVulnerability === vulnerability}
                    anySelected={!!props.selectedVulnerability}
                    onSelected={isSelected => props.selectVulnerability?.(isSelected ? vulnerability : null)}
                    hidden={removingItemIds.has(vulnerability) || !currentItemIds.has(vulnerability)}
                />
            ))}
        </div>
    );
};
